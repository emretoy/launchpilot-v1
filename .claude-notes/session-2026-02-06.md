# Oturum Özeti — 6 Şubat 2026

## Bu Oturumda Yapılanlar

### 1. Format Key Migrasyonu (TAMAMLANDI)
5 eski format key → yeni ASCII Türkçe key'lere taşındı:
- `pillar` → `rehber`
- `case-study` → `vaka-calismasi`
- `comparison` → `karsilastirma`
- `checklist` → `kontrol-listesi`
- `faq` → `sss`
- 3 yeni format eklendi: `liste`, `hikaye`, `teknik-analiz`
- `normalizeLegacyFormat()` eklendi (DB geri uyumluluk)
- 9+ dosyada güncelleme yapıldı, 43/43 kontrol geçti

### 2. v2.3 Blog Topic Scanner (TAMAMLANDI)
- Validation helper'ları eklendi: `validateFunnelStage`, `validateSearchIntent`, `validateQuarter`
- Supabase insert'e 8 yeni v2.3 alanı eklendi
- Kullanıcıya ALTER TABLE SQL verildi (çalıştırması gerekiyor)

### 3. Blog Yazma Prompt v2.3 + Image Prompt v1.2 (PLAN HAZIR, KOD YAZILMADI)
- Kullanıcı v2.3 blog yazma promptu paylaştı
- Kullanıcı v1.2 görsel üretim prompt şablonları paylaştı
- 8 fazlı uygulama planı hazırlandı: `.claude/plans/sharded-humming-parasol.md`
- **Hiçbir kod yazılmadı** — sadece plan aşamasında

### 4. Küçük UI Değişikliği (TAMAMLANDI)
- `blog-generator.tsx`: Görsel prompt PromptViewer eklendi
  - Step 2'ye ham şablon önizleme (satır ~507 civarı)
  - Result ekranına görseller üretilmeden önce gerçek prompt'lar (satır ~549 civarı)
  - `buildImagePrompt` import edildi
  - SEO & Detaylar içindeki duplike kaldırıldı

---

## SIRADAKI İŞ: v2.3 Blog Prompt Implementasyonu

### Plan Dosyası
`.claude/plans/sharded-humming-parasol.md` — 8 fazlı detaylı plan

### Yapılacaklar (8 dosya)
1. **`src/lib/blog-generator.ts`** — ANA DOSYA
   - Tipler genişlet: `BlogGenerateRequest` (topicData, formatRecommendation, dnaAnalysis), `BlogGenerateResult` (suggestedAuthor), `ImagePlaceholder` (type, alt, coverText, mood)
   - `TONE_STYLES` güncelle (fotoğrafçılık terimleri: editorial, bokeh, isometric vb.)
   - Yeni sabitler: `SECTOR_IMAGE_HINTS`, `IMAGE_NEGATIVE_PROMPT`, `IMAGE_MODEL_SUPPORTS_TEXT`
   - `sanitizeForImageAI()` ekle (TR→EN Gemini çeviri)
   - `parseImagePlaceholders()` yeniden yaz (COVER-IMAGE + IMAGE + eski fallback)
   - `parseTitleAndMeta()` güncelle (AUTHOR ekle)
   - `buildBlogPrompt()` TAMAMEN yeniden yaz — v2.3 prompt metni birebir kullanılacak
     - 4 değişken inject: DNA_ANALYSIS_JSON, TOPIC_JSON, FORMAT_JSON, FORMAT_TEMPLATE
   - `buildImagePrompt()` yeniden yaz — v1.2 şablonları (cover MOD B + content)

2. **`src/app/api/blog-generate/route.ts`** — Author parse, genişletilmiş request/response
3. **`src/app/api/blog-image/route.ts`** — Cover/content ayrımı, sanitize, yeni prompt
4. **`src/app/api/blog-recommend/route.ts`** — topicData pass-through
5. **`src/components/blog-generator.tsx`** — Props genişlet (topicData, dnaAnalysis), regex güncelle, data flow
6. **`src/components/site/categories/blog/calendar.tsx`** — topicData={selectedTopic} prop
7. **`src/components/site/categories/blog/production.tsx`** — topicData={selectedTopic} prop
8. **`src/components/site/categories/blog.tsx`** — dnaAnalysis prop pipe

### Uygulama Sırası
```
Phase 1 (tipler) → Phase 2 (sabitler) → Phase 3 (parse) → Phase 4-5 (prompt'lar) → Phase 6 (route'lar) → Phase 7-8 (frontend) → tsc check
```

### Kullanıcının Verdiği Prompt Metinleri (OTURUMDA PAYLAŞILDI)

**v2.3 Blog Yazma Prompt'u** — Tam metin paylaşıldı. Bölümleri:
- SİTE DNA ANALİZİ: {{DNA_ANALYSIS_JSON}} — tone_and_voice, target_audience, business_identity, cta_structure, revenue_model
- KONU BİLGİSİ: {{TOPIC_JSON}} — title, funnel_stage, target_persona, suggested_cta, keywords
- FORMAT TAVSİYESİ: {{FORMAT_JSON}} — recommendedFormat, recommendedLength, structure_tip
- FORMAT ŞABLONU: {{FORMAT_TEMPLATE}}
- İÇERİK KURALLARI: Başlık (H1, 60 char), Giriş (hook), İlk %20 = Cevap (featured snippet), Gövde, Kanıt & Deneyim ([DENEYİM] placeholder), Özet + CTA
- SEO: H1/H2/H3, internal link (<!-- INTERNAL-LINK: anchor | description -->), LSI
- E-E-A-T: <!-- AUTHOR: ... -->, kaynaklar, [DENEYİM]
- AI KOKUSUNU YOK ETME: Yasak kelimeler (TR+EN), burstiness kuralı, eksik bilgi itirafı
- GÖRSEL: COVER-IMAGE (<!-- COVER-IMAGE: sahne | TEXT: metin | MOOD: atmosfer -->) + IMAGE (<!-- IMAGE: sahne | ALT: alt text | TON: ton -->)
- ÇIKTI: <!-- TITLE -->, <!-- META -->, <!-- AUTHOR -->, sonra HTML

**v1.2 Görsel Prompt Şablonları** — Tam metin paylaşıldı:
- COVER-IMAGE MOD A (metin render edebilen model) + MOD B (edemez → negative space)
- IMAGE content şablonu (concept hint + ton stili + sektör + negative prompt)
- TON → STİL eşlemesi (ciddi/samimi/pratik/eğlenceli)
- SEKTÖR → GÖRSEL DİLİ eşlemesi (8 sektör)
- IMAGE_MODEL_SUPPORTS_TEXT = false (kie.ai)
- sanitizeForImageAI (TR→EN Gemini çeviri)

### Bekleyen İşler
- [ ] Supabase ALTER TABLE SQL çalıştırıldı mı? (8 yeni kolon: content_type, sub_topics, is_niche_opportunity, funnel_stage, search_intent, target_persona, suggested_cta, best_publishing_quarter)
- [ ] FORMAT_TEMPLATE dosyaları (9 format) — kullanıcı "sırayla vercem" dedi, henüz gelmedi
- [ ] GitHub push — oturum bitince yapılacak

---

## Teknik Notlar
- `buildRecommendPrompt()` zaten 3. parametre olarak `topicData` destekliyor (blog-generator.ts satır 199)
- kie.ai Nano Banana Pro modeli → metin render edemez → COVER-IMAGE için MOD B default
- `blog-generator.tsx`'te `buildImagePrompt` import'u ve Step 2 ham prompt önizleme bu oturumda eklendi
- `normalizeLegacyFormat` → blog.tsx'te ensureTopicIds içinde kullanılıyor (DB eski key dönüşümü)
